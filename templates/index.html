<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµ ìŠ¤ë§ˆíŠ¸ ì•„ì¹´ì´ë¸Œ</title>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ì•„ì´ì½˜ (Bootstrap Icons) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        /* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ìŠ¤íƒ€ì¼ */
        .nav-pills .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 8px 20px;
        }
        .nav-pills .nav-link.active {
            background-color: white;
            color: #0d6efd; /* Bootstrap Primary Color */
            font-weight: bold;
        }
        .nav-pills .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* ì¹´ë“œ ì´ë¯¸ì§€ ë†’ì´ ê³ ì • */
        .card-img-top {
            height: 250px;
            object-fit: cover;
        }

        /* ë§í¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ (4:3 ë¹„ìœ¨) */
        .link-card-img-wrapper {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 ë¹„ìœ¨ */
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .link-card-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
        }
        
        /* í˜¸ë²„ íš¨ê³¼ */
        .hover-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
            transition: all 0.3s;
        }

        /* ë“œë˜ê·¸ ë°©ì§€ (ì´ë¯¸ì§€ ë³´í˜¸) */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }

        /* ì ê¸ˆ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .lock-screen {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            border: 2px dashed #dee2e6;
        }
    </style>
</head>
<!-- ìš°í´ë¦­ ë°©ì§€, ë“œë˜ê·¸ ë°©ì§€, ì„ íƒ ë°©ì§€ ì ìš© -->
<body class="bg-light" oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (íŒŒë€ìƒ‰ ë°°ê²½ + íƒ­ ë©”ë‰´) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm py-3 sticky-top">
        <div class="container">
            <!-- ë¡œê³  í´ë¦­ ì‹œ í™ˆ(ì „ì²´ë³´ê¸°)ìœ¼ë¡œ ì´ë™ -->
            <a class="navbar-brand fw-bold fs-4 me-5" href="/">ğŸ« School Archive</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- ë©”ë‰´ ì•„ì´í…œ (íƒ­ ë²„íŠ¼) -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="nav nav-pills ms-auto" id="pills-tab" role="tablist">
                    <li class="nav-item me-2" role="presentation">
                        <button class="nav-link active" id="tab-media" data-bs-toggle="pill" data-bs-target="#content-media" type="button">
                            ğŸ“¸ ê°¤ëŸ¬ë¦¬
                        </button>
                    </li>
                    <li class="nav-item me-2" role="presentation">
                        <button class="nav-link" id="tab-text" data-bs-toggle="pill" data-bs-target="#content-text" type="button">
                            ğŸ“ ê²Œì‹œíŒ
                        </button>
                    </li>
                    <li class="nav-item me-2" role="presentation">
                        <button class="nav-link" id="tab-code" data-bs-toggle="pill" data-bs-target="#content-code" type="button">
                            ğŸ’» ê°œë°œ/ìë£Œ
                        </button>
                    </li>
                    <li class="nav-item me-2" role="presentation">
                        <button class="nav-link" id="tab-link" data-bs-toggle="pill" data-bs-target="#content-link" type="button">
                            ğŸ”— ê³µì‹ ë§í¬
                        </button>
                    </li>
                    
                    <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
                    <li class="nav-item ms-3 border-start ps-3" role="presentation">
                        {% if user.is_authenticated %}
                            <div class="dropdown">
                                <button class="btn btn-outline-light dropdown-toggle rounded-pill" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-person-circle me-1"></i> {{ user.username }}
                                </button>
                                <ul class="dropdown-menu">
                                    {% if user.is_superuser %}
                                    <li><a class="dropdown-item" href="/admin/">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    {% endif %}
                                    <!-- allauth ë¡œê·¸ì•„ì›ƒ URL -->
                                    <li><a class="dropdown-item text-danger" href="/accounts/logout/">ë¡œê·¸ì•„ì›ƒ</a></li>
                                </ul>
                            </div>
                        {% else %}
                            <!-- allauth êµ¬ê¸€ ë¡œê·¸ì¸ URL -->
                            <a href="/accounts/google/login/?process=login" class="btn btn-light rounded-pill text-primary fw-bold px-3">
                                <i class="bi bi-google me-1"></i> ë¡œê·¸ì¸
                            </a>
                        {% endif %}
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ë©”ì‹œì§€ ì•Œë¦¼ (ìŠ¹ì¸ ëŒ€ê¸° ë“±) -->
    {% if messages %}
    <div class="container mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ë©”ì¸ íƒ€ì´í‹€ ë° ê²€ìƒ‰ì°½ -->
    <div class="container py-5 text-center">
        <h2 class="fw-bold display-5 mb-3">ìš°ë¦¬ í•™êµì˜ ëª¨ë“  ìˆœê°„</h2>
        <p class="text-muted lead mb-4">AIì™€ í•¨ê»˜ ê¸°ë¡í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ ì•„ì¹´ì´ë¸Œ</p>
        
        <!-- ğŸ” ê²€ìƒ‰ì°½ (ë¡œê·¸ì¸ í•œ ì‚¬ëŒë§Œ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ í• ì§€ ì„ íƒ ê°€ëŠ¥. ì¼ë‹¨ì€ ëª¨ë‘ì—ê²Œ ë³´ì—¬ì£¼ë˜, ê²°ê³¼ëŠ” ì•„ë˜ íƒ­ì—ì„œ ë§‰í˜) -->
        {% if user.is_authenticated %}
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form action="/" method="GET" class="d-flex shadow-sm rounded-pill bg-white p-1 border">
                    <input type="text" name="q" class="form-control border-0 rounded-pill ps-4" 
                           placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì²´ìœ¡ëŒ€íšŒ, 2í•™ë…„)" 
                           value="{{ search_term }}" style="box-shadow: none;">
                    <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold">ê²€ìƒ‰</button>
                </form>
                {% if search_term %}
                    <div class="mt-3">
                        <span class="badge bg-secondary">ê²€ìƒ‰ì–´: "{{ search_term }}"</span>
                        <a href="/" class="text-decoration-none ms-2 small text-muted">ğŸ”„ ì „ì²´ë³´ê¸°</a>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- ì½˜í…ì¸  ì˜ì—­ (íƒ­ ë‚´ìš©) -->
    <div class="container pb-5">
        <div class="tab-content" id="pills-tabContent">
            
            <!-- 1. ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ (ì´ë¯¸ì§€/ì˜ìƒ) - ë¡œê·¸ì¸ í•„ìˆ˜ ğŸ”’ -->
            <div class="tab-pane fade show active" id="content-media" role="tabpanel">
                {% if user.is_authenticated %}
                    <div class="row row-cols-1 row-cols-md-3 g-4">
                        {% for post in media_posts %}
                        <div class="col">
                            <div class="card h-100 shadow-sm border-0 hover-shadow">
                                {% if post.file %}
                                <img src="{{ post.file.url }}" class="card-img-top" alt="{{ post.title }}" oncontextmenu="return false">
                                {% else %}
                                <div class="card-img-top d-flex align-items-center justify-content-center bg-secondary text-white">
                                    <span>ì´ë¯¸ì§€ ì—†ìŒ</span>
                                </div>
                                {% endif %}
                                
                                <div class="card-body">
                                    <h5 class="card-title fw-bold">{{ post.title }}</h5>
                                    <p class="card-text text-muted small">{{ post.description|truncatechars:50 }}</p>
                                    
                                    {% if post.ai_caption %}
                                    <div class="alert alert-info py-2 px-3 mt-3 mb-0 small border-0 bg-opacity-10 bg-info text-dark">
                                        <i class="bi bi-robot me-1 text-primary"></i> 
                                        {{ post.ai_caption }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="card-footer bg-white border-top-0 d-flex justify-content-between align-items-center">
                                    <small class="text-muted">{{ post.created_at|date:"Y-m-d" }}</small>
                                    <div>
                                        <i class="bi bi-heart-fill text-danger"></i> {{ post.like_count }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center py-5 text-muted">
                            <div class="fs-1 mb-3">ğŸ–¼ï¸</div>
                            <p>
                                {% if search_term %} '{{ search_term }}' ê²°ê³¼ ì—†ìŒ {% else %} ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤. {% endif %}
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- ğŸ”’ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ì•ˆë‚´ í™”ë©´ -->
                    <div class="lock-screen">
                        <div class="display-1 mb-3">ğŸ”’</div>
                        <h3 class="fw-bold">í•™êµ êµ¬ì„±ì› ì „ìš© ê³µê°„ì…ë‹ˆë‹¤</h3>
                        <p class="text-muted mb-4">ì‚¬ì§„ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <a href="/accounts/google/login/?process=login" class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm">
                            <i class="bi bi-google me-2"></i> êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
                        </a>
                    </div>
                {% endif %}
            </div>

            <!-- 2. ê²Œì‹œíŒ (ê¸€) - ë¡œê·¸ì¸ í•„ìˆ˜ ğŸ”’ -->
            <div class="tab-pane fade" id="content-text" role="tabpanel">
                {% if user.is_authenticated %}
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        {% for post in text_posts %}
                        <div class="col">
                            <div class="card h-100 border-2 hover-shadow">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2 text-secondary small">
                                        <span>{{ post.created_at|date:"Y.m.d" }}</span>
                                        <span>{{ post.author_name }}</span>
                                    </div>
                                    <h4 class="card-title fw-bold">{{ post.title }}</h4>
                                    <p class="card-text mt-3">{{ post.content|truncatechars:100 }}</p>
                                </div>
                                <div class="card-footer bg-white border-0 text-end">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#textModal{{ post.id }}">ë” ë³´ê¸°</button>
                                </div>
                            </div>

                            <!-- ëª¨ë‹¬ (ìƒëµ ì—†ì´ ë‚´ìš© í‘œì‹œ) -->
                            <div class="modal fade" id="textModal{{ post.id }}" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title fw-bold">{{ post.title }}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body py-4" style="white-space: pre-line;">{{ post.content }}</div>
                                        <div class="modal-footer">
                                            <small class="text-muted me-auto">ì‘ì„±ì: {{ post.author_name }}</small>
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center py-5 text-muted">
                            <p>ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- ğŸ”’ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ì•ˆë‚´ -->
                    <div class="lock-screen">
                        <div class="fs-1 mb-3">ğŸ“</div>
                        <h4 class="fw-bold">ê²Œì‹œíŒì€ ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤</h4>
                        <p class="text-muted">í•™êµ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                {% endif %}
            </div>

            <!-- 3. ê°œë°œ/ìë£Œ (ì½”ë“œ) - ë¡œê·¸ì¸ í•„ìˆ˜ ğŸ”’ -->
            <div class="tab-pane fade" id="content-code" role="tabpanel">
                {% if user.is_authenticated %}
                    <div class="row row-cols-1 row-cols-md-3 g-4">
                        {% for link in code_links %}
                        <div class="col">
                            <div class="card h-100 border-dark hover-shadow">
                                <div class="card-header bg-dark text-white d-flex justify-content-between">
                                    <span class="badge bg-secondary">{{ link.get_category_display }}</span>
                                    <small>{{ link.created_at|date:"m.d" }}</small>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title fw-bold">
                                        <i class="bi bi-code-slash me-2"></i>{{ link.title }}
                                    </h5>
                                    <!-- ì¤„ë°”ê¿ˆ í•„í„° ì ìš©ë¨ -->
                                    <p class="card-text text-muted small">{{ link.description|linebreaksbr }}</p>
                                </div>
                                <div class="card-footer bg-white border-0">
                                    <a href="{{ link.url }}" target="_blank" class="btn btn-dark w-100">
                                        ë°”ë¡œê°€ê¸° <i class="bi bi-box-arrow-up-right ms-1"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center py-5 text-muted">
                            <p>ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                     <!-- ğŸ”’ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì ì•ˆë‚´ -->
                     <div class="lock-screen">
                        <div class="fs-1 mb-3">ğŸ’»</div>
                        <h4 class="fw-bold">ìˆ˜ì—… ìë£ŒëŠ” ë¡œê·¸ì¸ í›„ í™•ì¸í•˜ì„¸ìš”</h4>
                        <p class="text-muted">ì™¸ë¶€ì¸ì˜ ì ‘ê·¼ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                    </div>
                {% endif %}
            </div>

            <!-- 4. ê³µì‹ ë§í¬ - ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŒ (ê³µê°œ) ğŸŒ -->
            <div class="tab-pane fade" id="content-link" role="tabpanel">
                <div class="row row-cols-2 row-cols-md-4 g-4">
                    {% for link in official_links %}
                    <div class="col">
                        <a href="{{ link.url }}" target="_blank" class="text-decoration-none text-dark">
                            <div class="card h-100 shadow-sm border-0 hover-shadow text-center">
                                <div class="link-card-img-wrapper rounded-top">
                                    <div class="link-card-icon">
                                        {% if link.icon_type == 'YOUTUBE' %}<i class="bi bi-youtube text-danger"></i>
                                        {% elif link.icon_type == 'INSTAGRAM' %}<i class="bi bi-instagram text-danger"></i>
                                        {% elif link.icon_type == 'BLOG' %}<i class="bi bi-pencil-square text-success"></i>
                                        {% else %}<i class="bi bi-globe text-primary"></i>{% endif %}
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h6 class="card-title fw-bold mb-0">{{ link.title }}</h6>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center py-5 text-muted">
                        <div class="fs-1 mb-3">ğŸ”—</div>
                        <p>ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>

    <!-- í•˜ë‹¨ í‘¸í„° -->
    <footer class="py-4 mt-auto bg-white border-top">
        <div class="container text-center text-muted">
            &copy; 2024 School Archive Project. All rights reserved.
        </div>
    </footer>

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- ë³´ì•ˆ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            // alert ì œê±°: ë„ˆë¬´ ìì£¼ ëœ¨ë©´ ë¶ˆí¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¡°ìš©íˆ ì°¨ë‹¨
        });
        
        document.onkeydown = function(e) {
            if(e.keyCode == 123) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        }
    </script>
</body>
</html>