###################################################

ğŸ« í•™êµ AI ì•„ì¹´ì´ë¸Œ í”„ë¡œì íŠ¸ ê°œë°œ ì™„ë£Œ ë³´ê³ ì„œ (v1.0)


ìµœì¢… ì—…ë°ì´íŠ¸: 2026ë…„ 1ì›” 5ì¼

###################################################

1. í”„ë¡œì íŠ¸ ê°œìš”

ëª©í‘œ: í•™êµ í™œë™ ì‚¬ì§„ì„ ê¸°ë¡í•˜ê³ , AIê°€ ìë™ìœ¼ë¡œ ì„¤ëª…ì„ ìƒì„±í•´ì£¼ëŠ” ìŠ¤ë§ˆíŠ¸ ì•„ì¹´ì´ë¸Œ í”Œë«í¼ êµ¬ì¶•.

ì„œë²„ í™˜ê²½: Oracle Cloud Infrastructure (OCI) ARM ì¸ìŠ¤í„´ìŠ¤ (Ubuntu).

ê¸°ìˆ  ìŠ¤íƒ: Django 6.0, Gunicorn, Nginx, SQLite.

í•µì‹¬ ê¸°ëŠ¥:

OCI Object Storage ì—°ë™: django-storagesì˜ boto3 í˜¸í™˜ì„± ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ OCI Native SDK ê¸°ë°˜ ì»¤ìŠ¤í…€ ìŠ¤í† ë¦¬ì§€ êµ¬í˜„.

Gemini AI ìë™ ë¶„ì„: ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ gemini-3-flash-preview ëª¨ë¸ì´ ì‚¬ì§„ì„ ë¶„ì„í•˜ì—¬ ìº¡ì…˜ ìë™ ìƒì„±.

íŒŒì¼ ìë™ ì‚­ì œ: ê²Œì‹œê¸€ ì‚­ì œ ì‹œ OCI ë²„í‚·ì˜ ì‹¤ì œ íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œ.

ë³´ì•ˆ ê°•í™”: .env íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë¯¼ê°í•œ API í‚¤ ê´€ë¦¬ ë° OCI ì¸ì¦ í‚¤ ë¶„ë¦¬.

2. í•´ê²°ëœ ì£¼ìš” ì´ìŠˆ (Troubleshooting)

OCI MissingContentLength ì—ëŸ¬ (411):

ì›ì¸: boto3ê°€ S3 í˜¸í™˜ ëª¨ë“œì—ì„œ Content-Length í—¤ë”ë¥¼ ëˆ„ë½í•˜ê±°ë‚˜ Chunked encodingì„ ì‚¬ìš©í•˜ì—¬ OCIê°€ ê±°ë¶€í•¨.

í•´ê²°: boto3ë¥¼ ì œê±°í•˜ê³  **Oracle ê³µì‹ Python SDK (oci)**ë¥¼ ì‚¬ìš©í•˜ëŠ” OCIStorage ë°±ì—”ë“œë¥¼ ì§ì ‘ ê°œë°œí•˜ì—¬ ì ìš©í•¨.

AI ë¶„ì„ ë¯¸ì‘ë™ (404 Error):

ì›ì¸: API í‚¤ ê¶Œí•œì— gemini-1.5-flash ëª¨ë¸ì´ í¬í•¨ë˜ì§€ ì•ŠìŒ.

í•´ê²°: ëª¨ë¸ ê°€ìš©ì„± í…ŒìŠ¤íŠ¸(check_ai.py) í›„ **gemini-3-flash-preview**ë¡œ ëª¨ë¸ ë³€ê²½.

ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤ì¢… (Django 6.0 í˜¸í™˜ì„±):

ì›ì¸: Django 6.0ë¶€í„° DEFAULT_FILE_STORAGE ì„¤ì •ì´ íê¸°ë¨.

í•´ê²°: STORAGES ë”•ì…”ë„ˆë¦¬ ì„¤ì •ìœ¼ë¡œ ë¬¸ë²• ìˆ˜ì •.

502 Bad Gateway:

ì›ì¸: signals.py ë¬¸ë²• ì˜¤ë¥˜ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¯¸ì„¤ì¹˜.

í•´ê²°: êµ¬ë¬¸ ìˆ˜ì • ë° pip install google-generativeai pillow oci python-dotenv ì™„ë£Œ.

3. í•µì‹¬ íŒŒì¼ ë° ì„¤ì • (í˜„ì¬ ìƒíƒœ)

3-1. í•„ìˆ˜ íŒ¨í‚¤ì§€

pip install django gunicorn oci google-generativeai pillow python-dotenv


3-2. OCI ì¸ì¦ ì„¤ì • (Native SDK)

ìœ„ì¹˜: /home/ubuntu/.oci/config (ë° oci_api_key.pem)

ê¶Œí•œ: chmod 600 í•„ìˆ˜.

ë‚´ìš©: User OCID, Tenancy OCID, Fingerprint, Key íŒŒì¼ ê²½ë¡œ í¬í•¨.

3-3. .env íŒŒì¼ (í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬)

ìœ„ì¹˜: í”„ë¡œì íŠ¸ ë£¨íŠ¸ (manage.pyì™€ ê°™ì€ ìœ„ì¹˜). .gitignoreì— ë°˜ë“œì‹œ í¬í•¨.

# Django Secret Key
SECRET_KEY='django-insecure-change-me-later-for-production'

# Gemini API Key
GEMINI_API_KEY='AIzaSyBRrPa6pMrbkDkP-isNWKubs3wAUDoCcHo'


3-4. config/storage.py (OCI Native SDK ìŠ¤í† ë¦¬ì§€)

íŠ¹ì´ì‚¬í•­: boto3ë¥¼ ì“°ì§€ ì•Šê³  oci ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë¨. Gunicorn ì‹¤í–‰ ê¶Œí•œ ë¬¸ì œë¥¼ ìœ„í•´ ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©.

import os
import oci
import logging
from django.conf import settings
from django.core.files.storage import Storage
from django.utils.deconstruct import deconstructible
from django.core.files.base import ContentFile
import mimetypes

logger = logging.getLogger('django')

@deconstructible
class OCIStorage(Storage):
    def __init__(self, option=None):
        try:
            self.config_profile = "DEFAULT"
            # Gunicorn ì‹¤í–‰ ê³„ì • ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•œ ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©
            self.config_path = "/home/ubuntu/.oci/config" 
            
            if not os.path.exists(self.config_path):
                raise FileNotFoundError(f"ğŸš¨ OCI Config ì—†ìŒ: {self.config_path}")

            self.config = oci.config.from_file(self.config_path, self.config_profile)
            self.object_storage = oci.object_storage.ObjectStorageClient(self.config)
            
            self.namespace = settings.OCI_NAMESPACE
            self.bucket_name = settings.AWS_STORAGE_BUCKET_NAME
            self.region = self.config['region']
        except Exception as e:
            logger.error(f"âŒ OCI Init Error: {e}")
            raise e

    def _save(self, name, content):
        try:
            content.seek(0)
            file_data = content.read()
            content_type, _ = mimetypes.guess_type(name)
            if not content_type: content_type = 'application/octet-stream'

            self.object_storage.put_object(
                self.namespace, self.bucket_name, name, file_data, content_type=content_type
            )
            return name
        except Exception as e:
            logger.error(f"âŒ Upload Error: {e}")
            raise e

    def url(self, name):
        return f"https://objectstorage.{self.region}[.oraclecloud.com/n/](https://.oraclecloud.com/n/){self.namespace}/b/{self.bucket_name}/o/{name}"


3-5. config/settings.py (í•µì‹¬ ì„¤ì •)

íŠ¹ì´ì‚¬í•­: .env ë¡œë“œ, Django 6.0 STORAGES ì„¤ì • ì ìš©, OCI Native URL ì‚¬ìš©.

from pathlib import Path
import os
from dotenv import load_dotenv

load_dotenv()

# ... (ê¸°ë³¸ ì„¤ì • ìƒëµ) ...

SECRET_KEY = os.getenv('SECRET_KEY')

# OCI Object Storage ì„¤ì • (Native SDK)
AWS_STORAGE_BUCKET_NAME = 'school-media'
OCI_NAMESPACE = 'axypprkugw7b'
OCI_REGION = 'ap-chuncheon-1'

# Django 6.0 í˜¸í™˜ ìŠ¤í† ë¦¬ì§€ ì„¤ì •
STORAGES = {
    "default": {
        "BACKEND": "config.storage.OCIStorage",
    },
    "staticfiles": {
        "BACKEND": "django.contrib.staticfiles.storage.StaticFilesStorage",
    },
}

# ë¯¸ë””ì–´ íŒŒì¼ URL
MEDIA_URL = f'https://objectstorage.{OCI_REGION}[.oraclecloud.com/n/](https://.oraclecloud.com/n/){OCI_NAMESPACE}/b/{AWS_STORAGE_BUCKET_NAME}/o/'


3-6. photo/signals.py (AI ë¶„ì„ & ìë™ ì‚­ì œ)

íŠ¹ì´ì‚¬í•­: gemini-3-flash-preview ëª¨ë¸ ì‚¬ìš©, .envì—ì„œ API í‚¤ ë¡œë“œ.

import google.generativeai as genai
from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from .models import MediaPost
from PIL import Image
import io
import logging
import os

logger = logging.getLogger('django')

# .envì—ì„œ API í‚¤ ë¡œë“œ
GEMINI_API_KEY = os.getenv('GEMINI_API_KEY')

if GEMINI_API_KEY:
    genai.configure(api_key=GEMINI_API_KEY)
else:
    logger.error("ğŸš¨ GEMINI_API_KEY ëˆ„ë½ë¨!")

# 1. AI ì´ë¯¸ì§€ ë¶„ì„
@receiver(post_save, sender=MediaPost)
def analyze_image_with_gemini(sender, instance, created, **kwargs):
    if not created or instance.ai_caption or not GEMINI_API_KEY: return

    try:
        with instance.file.open('rb') as f:
            image_bytes = f.read()
            if len(image_bytes) == 0: return
            image = Image.open(io.BytesIO(image_bytes))

        # gemini-3-flash-preview ì‚¬ìš©
        model = genai.GenerativeModel('gemini-3-flash-preview')
        prompt = "ì´ ì‚¬ì§„ì€ í•™êµ í™œë™ì„ ê¸°ë¡í•œ ì‚¬ì§„ì´ì•¼. í•™ìƒë“¤ì—ê²Œ ì„¤ëª…í•˜ë“¯ì´ ë”°ëœ»í•˜ê³  ê¸ì •ì ì¸ ë§íˆ¬(í•´ìš”ì²´)ë¡œ 2~3ë¬¸ì¥ ìš”ì•½í•´ì¤˜."
        
        response = model.generate_content([prompt, image])
        instance.ai_caption = response.text
        instance.save(update_fields=['ai_caption'])
        logger.info(f"âœ… AI Success: {instance.title}")
    except Exception as e:
        logger.error(f"âŒ AI Error: {e}")

# 2. íŒŒì¼ ìë™ ì‚­ì œ
@receiver(post_delete, sender=MediaPost)
def cleanup_file_on_delete(sender, instance, **kwargs):
    if instance.file:
        try:
            instance.file.delete(save=False)
            logger.info("âœ… File Deleted")
        except Exception as e:
            logger.error(f"âš ï¸ File Delete Error: {e}")


3-7. .gitignore ë° íŒŒì¼ êµ¬ì¡°

# .gitignore
.env
.oci/
oci_api_key.pem
__pycache__/
*.py[cod]
venv/
db.sqlite3
media/
media_posts/
images/
.DS_Store
.vscode/


/home/ubuntu/
â”œâ”€â”€ .oci/                         # [ë³´ì•ˆ] OCI ì¸ì¦ ì •ë³´ í´ë” (config, oci_api_key.pem)
â”‚
/var/www/school_project/          # [ë©”ì¸] í”„ë¡œì íŠ¸ ë£¨íŠ¸
â”œâ”€â”€ .env                          # [ë³´ì•ˆ] ë¹„ë°€í‚¤ ëª¨ìŒ
â”œâ”€â”€ check_ai.py                   # (ì§„ë‹¨ìš©)
â”œâ”€â”€ check_oci_native.py           # (ì§„ë‹¨ìš©)
â”œâ”€â”€ db.sqlite3                    # DB íŒŒì¼
â”œâ”€â”€ manage.py                     
â”œâ”€â”€ venv/                         
â”œâ”€â”€ static/                       
â”œâ”€â”€ templates/                    
â”‚   â””â”€â”€ index.html                
â”‚
â”œâ”€â”€ config/                       
â”‚   â”œâ”€â”€ settings.py               # [ìˆ˜ì •ë¨] .env ì ìš©, OCI Native SDK ì ìš©
â”‚   â”œâ”€â”€ storage.py                # [ìƒì„±ë¨] OCI Native SDK ì»¤ìŠ¤í…€ ìŠ¤í† ë¦¬ì§€
â”‚   â”œâ”€â”€ urls.py                   
â”‚   â””â”€â”€ wsgi.py                   
â”‚
â””â”€â”€ photo/                        
    â”œâ”€â”€ admin.py                  
    â”œâ”€â”€ apps.py                   # [ìˆ˜ì •ë¨] signals ë“±ë¡
    â”œâ”€â”€ models.py                 
    â”œâ”€â”€ signals.py                # [ìƒì„±ë¨] AI ë¡œì§
    â””â”€â”€ views.py                  


4. í–¥í›„ ê³¼ì œ ë° ê³ ë„í™” ê³„íš (Next Steps)

í˜„ì¬ëŠ” ê´€ë¦¬ìê°€ ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´ AIê°€ ë¶„ì„í•´ì£¼ëŠ” 'í•µì‹¬ ë°±ì—”ë“œ ê¸°ëŠ¥'ê¹Œì§€ ì™„ì„±ëœ ìƒíƒœì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ ëŸ°ì¹­ì„ ìœ„í•´ ë‹¤ìŒ ë‹¨ê³„ë“¤ì„ ì¶”ì²œí•©ë‹ˆë‹¤.

ğŸ” AI ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„:

ì§€ê¸ˆì€ AIê°€ ì„¤ëª…ë§Œ ë‹¬ì•„ì£¼ì§€ë§Œ, ì´ ì„¤ëª…(ai_caption)ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìê°€ "ì²´ìœ¡ëŒ€íšŒ", "ë™ì•„ë¦¬" ë“±ìœ¼ë¡œ ì‚¬ì§„ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì›¹í˜ì´ì§€(index.html)ì— ì¶”ê°€.

ğŸŒ ë„ë©”ì¸ ë° HTTPS ì—°ê²°:

í˜„ì¬ IP ì£¼ì†Œ(152.67...)ë¡œ ì ‘ì†í•˜ëŠ” ë°©ì‹ì„ í•™êµ ì´ë¦„ì´ ë“¤ì–´ê°„ ë„ë©”ì¸(ì˜ˆ: school-archive.com)ìœ¼ë¡œ ë³€ê²½.

ë³´ì•ˆì„ ìœ„í•´ ë¬´ë£Œ SSL(Let's Encrypt)ì„ ì ìš©í•˜ì—¬ https:// ì ‘ì† ì§€ì›.

ğŸ“± í”„ë¡ íŠ¸ì—”ë“œ ë””ìì¸ ê°œì„ :

í˜„ì¬ì˜ ê¸°ë³¸ Bootstrap ë””ìì¸ì„ í•™êµ ìƒ‰ìƒì´ë‚˜ ë¡œê³ ì— ë§ì¶° ì»¤ìŠ¤í„°ë§ˆì´ì§•.

ëª¨ë°”ì¼ì—ì„œë„ ì‚¬ì§„ì„ ë³´ê¸° í¸í•˜ë„ë¡ ë°˜ì‘í˜• ê°¤ëŸ¬ë¦¬ UI ê°œì„ .

ğŸ‘¥ ì‚¬ìš©ì ê¶Œí•œ í™•ì¥:

ì§€ê¸ˆì€ ìŠˆí¼ìœ ì €(ê´€ë¦¬ì)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•˜ì§€ë§Œ, ì„ ìƒë‹˜ì´ë‚˜ í•™ìƒíšŒ ì„ì›ìš© ê³„ì •ì„ ë§Œë“¤ì–´ ì—…ë¡œë“œ ê¶Œí•œ ë¶€ì—¬.

===================================================
5. ìš´ì˜ ë° ìœ ì§€ë³´ìˆ˜ ë§¤ë‰´ì–¼
===================================================

# 1. ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate
ê°€ìƒí™˜ê²½ ë¹„í™œì„±í™”
deactivate


# 2. ê¸°ì¡´ DB ë° ì„¤ê³„ë„ ì‚­ì œ (ì™„ì „ ì´ˆê¸°í™”)
rm db.sqlite3
rm -rf photo/migrations
mkdir -p photo/migrations
touch photo/migrations/__init__.py

# 3. DB ìƒˆë¡œ ë§Œë“¤ê¸°
python manage.py makemigrations
python manage.py migrate

# 4. ê´€ë¦¬ì ê³„ì • ìƒì„± (DBê°€ ì§€ì›Œì¡Œì„ ë•Œ ë‹¤ì‹œ ë§Œë“œëŠ” ë°©ë²•)
python manage.py createsuperuser
# (ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ y)

# 5. ì„œë²„ ì¬ì‹œì‘
sudo systemctl restart gunicorn
sudo systemctl restart nginx

ë¡œê·¸ í™•ì¸: sudo journalctl -u gunicorn -f ëª…ë ¹ì–´ë¡œ ì‹¤ì‹œê°„ ë””ë²„ê¹… ê°€ëŠ¥.
ëª¨ë¸ ë³€ê²½: í–¥í›„ gemini-3 ëª¨ë¸ì´ ë§Œë£Œë˜ê±°ë‚˜ ë” ì¢‹ì€ ëª¨ë¸ì´ ë‚˜ì˜¤ë©´ photo/signals.pyì—ì„œ ëª¨ë¸ëª… ìˆ˜ì • í•„ìš”.

ì €ì¥ì†Œ ì´ˆê¸°í™” ë° ì²« ì»¤ë°‹(Gitì—ê²Œ "ì´ í´ë”ë¥¼ ê´€ë¦¬í•´ì¤˜!"ë¼ê³  ëª…ë ¹í•˜ëŠ” ë²•)

# í”„ë¡œì íŠ¸ í´ë”ì¸ì§€ í™•ì¸
cd /var/www/school_project

# Git ì´ˆê¸°í™” (ì´ì œ .git í´ë”ê°€ ìƒê¹ë‹ˆë‹¤)
git init

# .gitignoreê°€ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ëª¨ë“  íŒŒì¼ ë‹´ê¸°
git add .

# ì»¤ë°‹ (ì €ì¥)
git commit -m "ì²« ë²ˆì§¸ ì»¤ë°‹: í•™êµ í™ë³´ í”Œë«í¼ ê¸°ë³¸ êµ¬ì¶• ì™„ë£Œ"